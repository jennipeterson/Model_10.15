{
    "contents" : "\n\n###################################################\n### Program to examine Chagas dynamics\n### \n###################################################\nrequire(deSolve)\n\nrequire (scatterplot3d)\n\n################################################################################\n#Parameters, probabilities and rates **All rates are annual\n################################################################################\n#B=uninfected triatomine bugs\n#V= Trypanosoma cruzi-infected triatomine bugs (vectors)\n#Ia= humans in the acute phase of Chagas disease\n#Ii=humans in the chronic indeterminate phase of Chagas disease\n#Id=humans in the chronic determinate phase of Chagas disease\n#IR= animals, some of which are competent T. cruzi hosts\n#Rfv = relative fitness of infected triatomines\n#K= triatomine carrying capacity\n#r = triatomine birth rate\n#mu = triatomine death rate  \n#muP= increase in death rate due to vector control \n#mu.R=animal death rate\n#muN= background human mortality rate\n#Beta.iab = rate of triatomine-host contact*probability of transmission from Ia-B\n#Beta.iib = rate of triatomine-host contact*probability of transmission from Ii-B\n#Beta.idb =  rate of triatomine-host contact*probability of transmission from Id-B\n#Beta.bi= rate of triatomine-host contact*probability of transmission from B-N\n#Beta.irb = rate of triatomine-animal host contact*probability of transmission from IR-B\n#Beta.bir = rate of triatomine-animal host contact*probability of transmission from B-IR\n#RH= number of animals in the system\n#N=number of humans\n#delta= rate of movement from Ia-Ii\n#sigma= rate of movement from Ii-Id  \n#alpha =Id death rate\n#ViabRH= Proportion of IR that can transmit CHagas- accounts for birds and maintains uninfecteds in population\n\n\n################################# #############################################\n##\n## JUST HUMANS & BUGS\n##\n###############################################################################\n\n\nChagasBasicModel=function(t, x, params){\n\n  B=x[1]\n  V=x[2]\n  Ia=x[3]\n  Ii=x[4]\n  Id=x[5]\n  \n  with(as.list(params),{\n    \n    \n    dB =  r*(B+(RfV*V))*((K - (B+V))/K) - (mu*muP)*B - (B*((Beta.iab*Ia) + (Beta.iib*Ii)+ (Beta.idb*Id))/(RH+N))\n    \n    dV =  (B*((Beta.iab*Ia) + (Beta.iib*Ii)+ (Beta.idb*Id)))/(RH+N) - ((mu*muP)*V)\n    \n    dIa =  (Beta.bi*V)*((N-(Ia+Ii+Id))/(N+RH)) - Ia*(delta+muN)\n    \n    dIi =  delta*Ia - Ii*(sigma+muN)\n    \n    dId = sigma*Ii - Id*(alpha+muN)\n    \n    \n    res=c(dB, dV, dIa, dIi, dId)\n    list(res)\n  }) }\n\n\n###################################################\n#####\n#####   Set initial host population size\n#####\n###################################################\nRfV = 0.9        ## relative fitness of infected bugs\nHost<-10\nK=100\n\n###################################################\n### Solves ODE and plots results as time series\n###################################################\n\nendtime = 50\ntimes  = seq(0, endtime, by=1/12)\n\n\nparas  = c(r = 36, mu = 1.73,  muP=1, muN=0.013,Beta.iab = 25.01, Beta.iib = 1.066, Beta.idb = 8.2, \n           Beta.bi= 0.02378, RH=0, N=Host, K=K,  delta = 6, sigma = 0.03, alpha =0.1, RfV=0.9) \n\n\nxstart = c( B=100, V=10, Ia=0,Ii=0,Id=0)\n\nout = as.data.frame(rk4(xstart, times, ChagasBasicModel, paras))\n\n#export data to excel sheet\nlibrary(xlsx)\nfile = file.choose();\nwrite.xlsx(out, file, sheetName=\"k100 muP1.75\")\n\n###   Plot out human hosts x time\n##\n#par(mfrow=c(1,1))\nlayout(matrix(c(1,2), nrow = 1), widths = c(1.35, 0.55))\npar(mar = c(5, 4, 4, 0.5))\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)',ylim = c(0, 10),\n     col=\"purple\",bty='l',pch=16)\npoints(times, out$Ia, col=\"blue\",pch=16)\npoints(times, out$Id, col=\"green\",pch=16) \npar(mar = c(5, 0, 4, 0.5))\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)',ylim = c(0, 10),\n     col='',bty='l',yaxt='n',axes=FALSE, ann=FALSE)\nlegend(-2,10,c(\"Acute\", \"Indeterminate\", \"Determinate\"), \n       lwd=3, col=c(\"blue\",\"purple\", \"green\"),ncol=1,cex=0.75,bty='o', box.lty=3)\n\n\n##\n##   All five variables\n##\n#par(mfrow=c(1,1))\n\nlayout(matrix(c(1,2), nrow = 1), widths = c(1.35, 0.55))\npar(mar = c(5, 4, 4, 0.5))\nmarks <- c(0.1,1,10,100,1000)\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)', \n     log = \"y\",ylim = c(0.1, 1000), col=\"purple\",bty='l',yaxt='n',pch=16)\naxis(2,at=marks,labels=marks)\npoints(times, out$B, col=\"orange\",pch=16)\npoints(times, out$V, col=\"red\",pch=16)\npoints(times, out$Ia, col=\"blue\",pch=16)\npoints(times, out$Id, col=\"green\",pch=16)\npar(mar = c(5, 0, 4, 0.5))\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)', log = \"y\",ylim = c(0.1, 1000),col='',bty='l',yaxt='n',axes=FALSE, ann=FALSE)\n\nlegend(-2,1400,c(\"Acute\", \"Indeterminate\", \"Determinate\", \"Bugs\", \"Vectors\"), \n       lwd=3, col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),ncol=1,cex=0.75,bty='o', box.lty=3)\n\n\n\n\nlegend(\"topright\", inset=c(-0.5,0), legend=c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\"), \n       lwd=3, title='',ncol=2,col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"))\n\n\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.05,-0.04), leg.text,lwd=2,ncol=2,col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n###\n\n##\n##   Relationship between Bug and Vector abundance and cases\n###\n###\n\npar(mfrow=c(1,1))\nplot(out$V, out$Ii, ylab='Infected humans', xlab='Infected Vector Abundance', col = \"purple\",\n       main = \"Infected vector abundance vs. human cases\",xlim = c(0, 800),ylim = c(0, 10))\npoints(out$V, out$Id, col=\"green\")\npoints(out$V, out$Ia, col=\"blue\")\nleg.text<-c(\"Chr. indeterminate\", \"Acute\", \"Chr. determinate\")\nlegend(\"topleft\",leg.text,lty=rep(1,4),col=c(\"purple\",\"blue\", \"green\"),bty=\"n\")\n#\n#\n #\n##################################################################################\n###  Section 10 : to produce bifurcation diagram\n###  Runs model for a range of vector carrying capacities\n###  and plots out a section across the last five years of the models output\n###\n#################################################################################\n\nendt = 50.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nKmax = 1000\nKmin = 10\n\nKsec=seq(Kmin, Kmax, length=sections+1)\n\nBmat=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmat=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimat=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamat=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmat=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\n  for(i in 1:sections){\n\nparas  = c(r = 36,mu = 1.73,muN=0.013, Beta.iab = 25.01, Beta.iib = 1.066, Beta.idb = 8.2, \n           Beta.bi= 0.02378, muP=1, N=Host, K=Ksec[i],  delta = 6, sigma = 0.03, \n           alpha =0.1, RH=0, RfV=0.9) \n\n\nxstart = c( B=Ksec[i], V=10, Ia=0,Ii=0,Id=0)\n\n############################################\n \noutB = as.data.frame(lsoda(xstart, times, ChagasBasicModel, paras))\n    for(j in 1:(endt*int)){\n  Bmat[i,j]=outB$B[j]\n  Vmat[i,j]=outB$V[j]\n  Iamat[i,j]=outB$Ia[j]\n  Iimat[i,j]=outB$Ii[j]\n  Idmat[i,j]=outB$Id[j]\n\n  } \n\n##\n##\n\n  cat(i, \"\\n\")\n}\n\n#export data to excel sheet\nlibrary(xlsx)\nfile = file.choose();\nwrite.xlsx(out, file, sheetName=\"output\")\n\n###\n###   \n\n#par(mfrow=c(1,1))  \n\n\n  sel=seq(resfst, reslst, by=int)\n  plot(1E-4,xlim=c(Kmin,Kmax), log='y',  ylim=c(1, 600),\n  col='red',  xlab='Triatomine bug carrying capacity (K)', ylab='Number of individuals',bty='l')\n  for(i in 1:sections){\n    #points(rep(Ksec[i], length(sel)), Iamat[i, sel], col='blue')\n    points(rep(Ksec[i], length(sel)), Iimat[i, sel], col='purple')\n    points(rep(Ksec[i], length(sel)), Idmat[i, sel], col='green') \n    points(rep(Ksec[i], length(sel)), Bmat[i,sel], col='orange', pch=20) \n    points(rep(Ksec[i], length(sel)), Vmat[i, sel], col='red', pch=20)\n\n}\nexp=TRUE\nleg.text<-c( \"Ii\", \"Id\",\"B\",\"V\")\nlegend(\"topright\",inset=c(-.025,.18),leg.text,lty=rep(1,4),col=c(\"purple\", \"green\",\"orange\",\"red\"),bty=\"n\")    \n\n\n###\n###    Bifurcation across changes in abundance of human hosts\n#Host<-10\nK=1000\n\nendt = 150.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nHmax = 300\nHmin = 2\n\nHsec=seq(Hmin, Hmax, length=sections+1)\n\nBmatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nNmatH=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\n  for(i in 1:sections){\n\nparas  = c(r = 36, mu = 1.73,muN=0.013, Beta.iab = 25.01, Beta.iib = 1.066, \n           Beta.idb = 8.2, Beta.bi= 0.02378, muP=1, RH=0, N=Hsec[i], K=K,  \n           delta = 6, sigma = 0.03, alpha =0.1,RH=0, RfV=0.9) \n\n\nxstart = c( B=K/2, V=10, Ia=0,Ii=0,Id=0)\n\n############################################\n \noutBH = as.data.frame(lsoda(xstart, times, ChagasBasicModel, paras))\n    for(j in 1:(endt*int)){\n  BmatH[i,j]=outBH$B[j]\n  VmatH[i,j]=outBH$V[j]\n  IamatH[i,j]=outBH$Ia[j]\n  IimatH[i,j]=outBH$Ii[j]\n  IdmatH[i,j]=outBH$Id[j]\n  } \n\n##\n##\n\n  cat(i, \"\\n\")\n}\n#export data to excel sheet\nlibrary(xlsx)\nfile = file.choose();\nwrite.xlsx(out, file, sheetName=\"output\")\n###\n###   \n\n #Plots\n\n\n  sel=seq(resfst, reslst, by=int)\n  #par(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\n  plot(1E-4, xlim=c(Hmin,Hmax), ylim=c(1, 800), log='y',\n  col='blue', xlab='Human population size', ylab='Number of Individuals',bty=\"l\")\n  for(i in 1:sections){\n    points(rep(Hsec[i], length(sel)), IamatH[i, sel], col='blue',pch=16)\n    points(rep(Hsec[i], length(sel)), IimatH[i, sel], col='purple',pch=16)\n    points(rep(Hsec[i], length(sel)), IdmatH[i, sel], col='green',pch=16) \n    points(rep(Hsec[i], length(sel)), BmatH[i,sel], col='orange', pch=16) \n    points(rep(Hsec[i], length(sel)), VmatH[i, sel], col='red', pch=16)\n\n}\nexp=TRUE\nleg.text<-c(\"Acute\", \"Indeterminate\", \"Determinate\",\"Bugs\",\"Vectors\")\nlegend(\"bottomleft\",inset=c(0.25,0),ncol=2,leg.text,col=c(\"blue\", \"purple\", \"green\",\"orange\",\"red\" ),bty=\"n\",cex=0.8,pch=16)    \n\n##########################################################################\n####\n###    Bifurcation across changes in vector death rate\n######################################################################\nHost<-10\nK=1000\n\nendt = 50.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nPmax = 20\nPmin = 1\n\nPsec=seq(Pmin, Pmax, length=sections+1)\n\nBmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\n  for(i in 1:sections){\n\nparas  = c(r = 36, muN=0.013, mu = 1.73, Beta.iab = 25.01, Beta.iib = 1.066, \n           Beta.idb = 8.2, Beta.bi= 0.02378, \n           muP=Psec[i], RH=0, N=Host, K=K,  delta = 6, sigma = 0.03, alpha =0.1) \n\n\nxstart = c( B=K, V=10, Ia=0,Ii=0,Id=0)\n\n############################################\n \noutB = as.data.frame(lsoda(xstart, times, ChagasBasicModel, paras))\n    for(j in 1:(endt*int)){\n  Bmat[i,j]=outB$B[j]\n  Vmat[i,j]=outB$V[j]\n  Iamat[i,j]=outB$Ia[j]\n  Iimat[i,j]=outB$Ii[j]\n  Idmat[i,j]=outB$Id[j]\n\n  } \n\n##\n##\n\n  cat(i, \"\\n\")\n}\n\n###\n###   \n\npar(mfrow=c(1,1))  \n\n\n  sel=seq(resfst, reslst, by=int)\n  par(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\n  plot(1E-4, xlim=c(Pmin,Pmax), ylim=c(0.5, 600), log='y',\n  col='red', xlab='Bug mortality increase factor', ylab='Individuals')\n  for(i in 1:sections){\n    points(rep(Psec[i], length(sel)), Iamat[i, sel], col='blue')\n    points(rep(Psec[i], length(sel)), Iimat[i, sel], col='purple')\n    points(rep(Psec[i], length(sel)), Idmat[i, sel], col='green') \n    points(rep(Psec[i], length(sel)), Bmat[i,sel], col='orange', pch=20 ) \n    points(rep(Psec[i], length(sel)), Vmat[i, sel], col='red', pch=20)\n\n}\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\", title(paste( \"Infecteds vs. bug mortality from insecticides (K= 1000)\")))  \nlegend(\"topright\",leg.text,lty=rep(1,4),col=c(\"blue\", \"purple\", \"green\", \"orange\",\"red\" ),bty=\"n\") \n\n##########################################################################\n####\n###    Bifurcation across changes in vector birth rate\n######################################################################\nHost = 10\nK=1000\n\n\nendt = 50.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nrPmax = 1\nrPmin = 0.01\n\nrPsec=seq(rPmin, rPmax, length=sections+1)\n\nBmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\nfor(i in 1:sections){\n  \n  paras  = c(r = 36, rP=rPsec[i], mu = 1.73,muN=0.013, Beta.iab = 25.01, Beta.iib = 1.066, \n             Beta.idb = 8.2, Beta.bi= 0.02378, \n             muP=1, N=10, K=1000,  delta = 6, sigma = 0.03, alpha =0.1) \n  \n  \n  xstart = c( B=K, V=10, Ia=0,Ii=0,Id=0)\n  \n  ############################################\n  \n  outrP = as.data.frame(lsoda(xstart, times, ChagasBasicModel, paras))\n  for(j in 1:(endt*int)){\n    BmatrP[i,j]=outrP$B[j]\n    VmatrP[i,j]=outrP$V[j]\n    IamatrP[i,j]=outrP$Ia[j]\n    IimatrP[i,j]=outrP$Ii[j]\n    IdmatrP[i,j]=outrP$Id[j]\n    \n  } \n  \n  \n  \n  ##\n  ##\n  \n  cat(i, \"\\n\")\n}\n\n###\n###   \n\npar(mfrow=c(1,1))  #Hopefully a single plot\n\n\nsel=seq(resfst, reslst, by=int)\npar(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\nplot(1E-4, xlim=c(rPmin,rPmax), ylim=c(0.1, 10), log='y',\n     col='red', xlab='Bug reproduction decrease', ylab='Number of individuals',bty='l')\nfor(i in 1:sections){\n  points(rep(rPsec[i], length(sel)), IamatrP[i, sel], col='blue')\n  points(rep(rPsec[i], length(sel)), IimatrP[i, sel], col='purple')\n  points(rep(rPsec[i], length(sel)), IdmatrP[i, sel], col='green') \n  #points(rep(rPsec[i], length(sel)), BmatrP[i,sel], col='orange', pch=20 ) \n  #points(rep(rPsec[i], length(sel)), VmatrP[i, sel], col='red', pch=20)\n  \n}\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.03,-0.04), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\", title(paste( \"Infecteds vs. bug mortality from insecticides (K= 1000)\")))  \nlegend(\"topright\",leg.text,lty=rep(1,4),col=c(\"blue\", \"purple\", \"green\", \"orange\",\"red\" ),bty=\"n\")    \n\n\n\n\n### \n#\n###\n###  \n##  ################################# #############################################\n##\n##   Now add in animals \n##\n###############################################################################\n\nChagasResModel=function(t, x, params){\n\n  B=x[1]\n  V=x[2]\n  Ia=x[3]\n  Ii=x[4]\n  Id=x[5]\n  IR=x[6]\n  \n  with(as.list(params),{\n    \n    dB =  r*(B+(RfV*V))*((K - (B+V))/K) - (mu*muP)*B - (B*((Beta.iab*Ia)+(Beta.iib*Ii)+\n                (Beta.idb*Id)+(Beta.irb*IR)))/(RH+N)\n    \n    dV =  B*((Beta.iab*Ia) + (Beta.iib*Ii)+ (Beta.idb*Id)+(Beta.irb*IR))/(RH+N) - ((mu*muP)*V)\n    \n    dIa =  (Beta.bi*V)*(N-(Ia+Ii+Id))/(N+RH) - Ia*(delta+muN)\n    \n    dIi =  delta*Ia -  Ii*(sigma+muN)\n    \n    dId = sigma*Ii - Id*(alpha+muN)\n    \n    dIR = V*Beta.bir*((ViaRH*RH)-IR)/(N+RH) - mu.R*IR \n    \n    res=c(dB, dV, dIa, dIi, dId, dIR)\n    list(res)\n  }) }\n###################################################\n#####\n#####   Set initial host population size\n#####\n###################################################\n\nResHosts<-20     ## Density of other hosts that bugs feed on\nViabRH<-0.75      ##  Proportion of these hosts that can transmit CHagas- accounts for birds and maintains uninfecteds in population\nRfV = 0.9        ## relative fitness of infected bugs\nHost = 10\n\n\n###################################################\n### Solves ODE and plots results as time series\n###################################################\n\nendtime = 50\ntimes  = seq(0, endtime,by=1/12)\n\nparas  = c(r = 36, mu = 1.73, muN=0.013,Beta.iab = 25.01, Beta.iib = 1.066, Beta.idb = 8.2, \n           Beta.irb = 19.078,Beta.bi= 0.02378, Beta.bir = 0.8169, ViaRH = ViabRH,\n           muP=1, mu.R=0.5, RH=ResHosts, N=Host, K=((ResHosts*10)+100),  delta = 6, sigma = 0.03, alpha =0.1, RfV=RfV) \n\n\nxstart = c( B=100, V=10, Ia=0,Ii=0,Id=0, IR=0)\n\nout = as.data.frame(rk4(xstart, times, ChagasResModel, paras))\n\nfile = file.choose();\nwrite.xlsx(out, file, sheetName=\"mort1.25_K100\")\n\n###   Plot out human hosts x time\n##\npar(mfrow=c(1,1))\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)',ylim = c(0, 10),\n     col=\"purple\",bty='l')\n##points(times, out$A, col=\"orange\")\n##points(times, out$V, col=\"red\")\npoints(times, out$Ia, col=\"blue\")\npoints(times, out$Id, col=\"green\")\n\npar(xpd=TRUE)  \nleg.text<-c( \"Acute\",\"Indeterminate\", \"Determinate\")\nlegend(\"topright\",inset=c(-0.1,-0.1),leg.text,lwd=3,col=c(\"blue\",\"purple\", \"green\"),bty=\"n\")\n\n##\n##   All five variables\n##\npar(mfrow=c(1,1))\n\nplot(times, out$Ii, ylab='Number of individuals', xlab='Time (years)',log='y', ylim = c(0.1, 1000),\n     col=\"purple\",bty=\"l\")\npoints(times, out$B, col=\"orange\")\npoints(times, out$V, col=\"red\")\npoints(times, out$Ia, col=\"blue\")\npoints(times, out$Id, col=\"green\")\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"topright\",inset=c(-0.05,-0.05), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.05,-0.04), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.22,-0.05), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\n\n\n###\n###\n##    Bifurcation across changes in abundance of animals with K as a function of RH\n##\n#ResHosts<-20     ## Density of other hosts that bugs feed on\nViabRH<-0.01      ##  Proportion of these hosts that can transmit CHagas- accounts for birds and maintains uninfecteds in population\nRfV = 0.9        ## relative fitness of infected bugs\nHost = 10\n#K=(RH*50)\n\nendt = 50.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nRmax = 200\nRmin = 5\n\nRsec=seq(Rmin, Rmax, length=sections+1)\n\nBmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIRmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\n  for(i in 1:sections){\n\nparas  = c(r = 36, mu=1.73, mu.R = 0.5,muN=0.013, Beta.iab = 25.01, Beta.iib = 1.066, \n           Beta.idb = 8.2,Beta.irb = 19.078, Beta.bi=  0.02378, Beta.bir = 0.8169,\n   muP=1, ViaRH = ViabRH, RH=Rsec[i], N=Host, K=((Rsec[i]*25)+100),  delta = 6, sigma = 0.03, alpha =0.1, RfV=RfV) \n\n\nxstart = c( B=100, V=10, Ia=0, Ii=0, Id=0, IR=0)\n\n############################################\n \noutB = as.data.frame(lsoda(xstart, times, ChagasResModel, paras))\n    for(j in 1:(endt*int)){\n  BmatR[i,j]=outB$B[j]\n  VmatR[i,j]=outB$V[j]\n  IamatR[i,j]=outB$Ia[j]\n  IimatR[i,j]=outB$Ii[j]\n  IdmatR[i,j]=outB$Id[j]\n  IRmatR[i,j]=outB$IR[j]\n  } \n\n##\n##\n\n  cat(i, \"\\n\")\n}\n\nlibrary(xlsx)\nfile2 = file.choose();\nwrite.xlsx(out, file2, sheetName=\"output\")\n###\n###   \n\n    \nsel=seq(resfst, reslst, by=int)\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\n  plot(1E-4, xlim=c(Rmin,Rmax), ylim=c(1, 7), \n  col='red', xlab='Animal abundance',sub='1% viable; K=25*RH', ylab='Number of individuals',bty='l')\n  for(i in 1:sections){\n    #points(rep(Rsec[i], length(sel)), IamatR[i, sel], col='blue')\n    points(rep(Rsec[i], length(sel)), IimatR[i, sel], col='purple')\n    points(rep(Rsec[i], length(sel)), IdmatR[i, sel], col='green') \n    points(rep(Rsec[i], length(sel)), BmatR[i,sel], col='orange', pch=20) \n    points(rep(Rsec[i], length(sel)), VmatR[i, sel], col='red', pch=20)\n}\n\npar(xpd=TRUE)\nleg.text<-c( \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"topright\",inset=c(-0.05,-0.1),leg.text,lwd=3,col=c( \"purple\", \"green\", \"orange\",\"red\" ),bty='n')    \n\n\npar(xpd=TRUE)\nleg.text<-c( \"Ii\", \"Id\")\nlegend(\"topright\",inset=c(-0.05,-0.1),leg.text,lwd=3,col=c( \"purple\", \"green\" ),bty='n')    \n\n\n\n##########################################################################\n####\n###    Bifurcation across changes in vector death rate\n######################################################################\nHost<-10\nK=1000\n\nendt = 50\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nPmax = 20\nPmin = 1\n\nPsec=seq(Pmin, Pmax, length=sections+1)\n\nBmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIRmatR=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\nfor(i in 1:sections){\n\n  \n  paras  = c(r = 36, mu=1.73,muN=0.013, mu.R = 0.5, Beta.iab = 25.01, Beta.iib = 1.066, \n             Beta.idb = 8.2,Beta.irb = 19.078, Beta.bi=  0.02378, Beta.bir = 0.8169,\n             muP=Psec[i], ViaRH = 0.75, RH=20, N=10, K=500,  delta = 6, \n             sigma = 0.03, alpha =0.1, RfV=0.9) \n  \n  \n  \n  xstart = c( B=K, V=100, Ia=0,Ii=0,Id=0,IR=0)\n  \n  ############################################\n  \n  outB = as.data.frame(lsoda(xstart, times, ChagasResModel, paras))\n  for(j in 1:(endt*int)){\n    BmatR[i,j]=outB$B[j]\n    VmatR[i,j]=outB$V[j]\n    IamatR[i,j]=outB$Ia[j]\n    IimatR[i,j]=outB$Ii[j]\n    IdmatR[i,j]=outB$Id[j]\n    IRmatR[i,j]=outB$IR[j]\n  } \n  \n  ##\n  ##\n  \n  cat(i, \"\\n\")\n}\n\nfile = file.choose();\nwrite.xlsx(outB, file, sheetName=\"birth decrease 1%\")\n\n###\n###   \n\npar(mfrow=c(1,1))  \n\nsel=seq(resfst, reslst, by=int)\npar(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\nplot(1E-4, xlim=c(1,20), ylim=c(0.1, 350),log='y',\n     col='red', xlab='Increase in annual bug mortality rate', sub='birth rate reduced by 50%',\n     ylab='Number of Individuals', bty = 'l')\nfor(i in 1:sections){\n  points(rep(Psec[i], length(sel)), IamatR[i, sel], col='blue')\n  points(rep(Psec[i], length(sel)), IimatR[i, sel], col='purple')\n  points(rep(Psec[i], length(sel)), IdmatR[i, sel], col='green') \n  points(rep(Psec[i], length(sel)), BmatR[i,sel], col='orange', pch=20 ) \n  points(rep(Psec[i], length(sel)), VmatR[i, sel], col='red', pch=20)\n  \n}\nleg.text<-c(\"B\", \"V\")  \nlegend(\"topright\",leg.text,lty=rep(1,4),col=c(\"orange\",\"red\" ),bty=\"n\")    \n\n\n### \n#\n###\n\n\n##########################################################################\n####\n###    Bifurcation across changes in vector birth rate\n######################################################################\nResHosts<-20     ## Density of other hosts that bugs feed on\nViabRH<-0.75      ##  Proportion of these hosts that can transmit CHagas- accounts for birds and maintains uninfecteds in population\nRfV = 0.9        ## relative fitness of infected bugs\nHost = 10\nK=1000\n\n\nendt = 50.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-5)\n\nsections = 40\n\nrPmax = 1\nrPmin = 0.01\n\nrPsec=seq(rPmin, rPmax, length=sections+1)\n\nBmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIRmatrP=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\nfor(i in 1:sections){\n  \n  paras  = c(r = 36, rP=rPsec[i], mu = 1.73, muN=0.013, mu.R = 0.5, Beta.iab = 25.01, \n             Beta.iib = 1.066, \n             Beta.idb = 8.2,Beta.irb = 19.078, Beta.bi= 0.02378, Beta.bir = 0.8169,\n             muP=1.75,ViaRH = 0.75, RH=20, N=10, K=1000,  delta = 6, sigma = 0.03, alpha =0.1,RfV=0.9) \n  \n  \n  xstart = c( B=K, V=10, Ia=0,Ii=0,Id=0,IR=0)\n  \n  ############################################\n  \n  outrP = as.data.frame(lsoda(xstart, times, ChagasResModel, paras))\n  for(j in 1:(endt*int)){\n    BmatrP[i,j]=outrP$B[j]\n    VmatrP[i,j]=outrP$V[j]\n    IamatrP[i,j]=outrP$Ia[j]\n    IimatrP[i,j]=outrP$Ii[j]\n    IdmatrP[i,j]=outrP$Id[j]\n    IRmatrP[i,j]=outrP$IR[j]\n    \n  } \n  \n  \n  \n  ##\n  ##\n  \n  cat(i, \"\\n\")\n}\n\n###\n###   \n\npar(mfrow=c(1,1))  \n\n\nsel=seq(resfst, reslst, by=int)\npar(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\nplot(1E-4, xlim=c(rPmin,rPmax), ylim=c(0.1, 500), log='y',\n     col='red', xlab='Bug reproduction decrease', ylab='Number of individuals',bty='l')\nfor(i in 1:sections){\n  points(rep(rPsec[i], length(sel)), IamatrP[i, sel], col='blue')\n  points(rep(rPsec[i], length(sel)), IimatrP[i, sel], col='purple')\n  points(rep(rPsec[i], length(sel)), IdmatrP[i, sel], col='green') \n  points(rep(rPsec[i], length(sel)), BmatrP[i,sel], col='orange', pch=20 ) \n  points(rep(rPsec[i], length(sel)), VmatrP[i, sel], col='red', pch=20)\n  \n}\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.03,-0.04), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\", title(paste( \"Infecteds vs. bug mortality from insecticides (K= 1000)\")))  \nlegend(\"topright\",leg.text,lty=rep(1,4),col=c(\"blue\", \"purple\", \"green\", \"orange\",\"red\" ),bty=\"n\")  \n\n##########################################################################\n####\n###    Bifurcation across changes in K\n######################################################################\nResHosts<-20     ## Density of other hosts that bugs feed on\nViabRH<-0.75      ##  Proportion of these hosts that can transmit CHagas- accounts for birds and maintains uninfecteds in population\nRfV = 0.9        ## relative fitness of infected bugs\nHost = 10\n#K=1000\n\n\nendt = 5.0\nint = 12\ntimes = seq(0, endt, by = 1/int)\n\nreslst = endt*int\nresfst = int*(endt-1)\n\nsections = 40\n\nKmax = 1000\nKmin = 1\n\nKsec=seq(Kmin, Kmax, length=sections+1)\n\nBmatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nVmatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIimatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIamatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIdmatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\nIRmatK=matrix(NA, ncol = endt*int+1, nrow = sections+1)\n\n\nfor(i in 1:sections){\n  \n  paras  = c(r = 36, mu = 1.73, muN=0.013, mu.R = 1, Beta.iab = 25.01, \n             Beta.iib = 1.066, muP=1,\n             Beta.idb = 8.2,Beta.irb = 19.078, Beta.bi= 0.02378, Beta.bir = 0.8169,\n             ViaRH = 0.75, RH=20, N=10,K=Ksec,  delta = 6, sigma = 0.03, alpha =0.1,RfV=0.9) \n  \n  \n  xstart = c( B=100, V=10, Ia=0,Ii=0,Id=0,IR=0)\n  \n  ############################################\n  \n  outK = as.data.frame(lsoda(xstart, times, ChagasResModel, paras))\n  for(j in 1:(endt*int)){\n    BmatK[i,j]=outK$B[j]\n    VmatK[i,j]=outK$V[j]\n    IamatK[i,j]=outK$Ia[j]\n    IimatK[i,j]=outK$Ii[j]\n    IdmatK[i,j]=outK$Id[j]\n    IRmatK[i,j]=outK$IR[j]\n    \n  } \n  \n  \n  \n  ##\n  ##\n  \n  cat(i, \"\\n\")\n}\n\n###\n###   \n\npar(mfrow=c(1,1))  \n\n\nsel=seq(resfst, reslst, by=int)\npar(mfrow=c(1,1))\n#  plot(1E-4, xlim=c(Vmin,Vmax), ylim=c(min(IPmat[,sel], na.rm=T), max(Smat[,sel], na.rm=T)), log='y',\nplot(1E-4, xlim=c(Kmin,Kmax), ylim=c(0.1, 800), log='y',\n     col='red', xlab='K', ylab='Number of individuals',bty='l')\nfor(i in 1:sections){\n  points(rep(Ksec[i], length(sel)), IamatK[i, sel], col='blue')\n  points(rep(Ksec[i], length(sel)), IimatK[i, sel], col='purple')\n  points(rep(Ksec[i], length(sel)), IdmatK[i, sel], col='green') \n  points(rep(Ksec[i], length(sel)), BmatK[i,sel], col='orange', pch=20 ) \n  points(rep(Ksec[i], length(sel)), VmatK[i, sel], col='red', pch=20)\n  \n}\n\npar(xpd=TRUE)\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\")\nlegend(\"bottomright\",inset=c(-0.03,-0.04), ncol=2, leg.text,lty=rep(1,4),col=c(\"blue\",\"purple\", \"green\",\"orange\", \"red\"),bty=\"n\")\n\nleg.text<-c(\"Ia\", \"Ii\", \"Id\", \"B\", \"V\", title(paste( \"Infecteds vs. bug mortality from insecticides (K= 1000)\")))  \nlegend(\"topright\",leg.text,lty=rep(1,4),col=c(\"blue\", \"purple\", \"green\", \"orange\",\"red\" ),bty=\"n\")    \n\n\n\n",
    "created" : 1443139625786.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4100053653",
    "id" : "808D9B0D",
    "lastKnownWriteTime" : 1443461288,
    "path" : "~/Desktop/Gates paper #1/Submitted sept 1/Chagas Model Code.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}